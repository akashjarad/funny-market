machine:  
  pre:
     - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
  node:
    version: 6.2.0
  services:
     - docker 

checkout:
  post:
    - git submodule sync
    - git submodule update --init

dependencies:  
  pre:
     - sudo pip install docker-compose     
     - sudo docker-compose -v
     - sudo docker -v
test:
  pre:
     - git grep --color TODO | cat 
  override:     
     - docker-compose -f docker-compose_test_.yml run --no-deps cars
     - docker-compose -f docker-compose_test_.yml run --no-deps profile
     - docker-compose -f docker-compose_test_.yml run --no-deps gateway
     - docker-compose -f docker-compose_test_.yml run --no-deps web
  post:   
     - docker-compose stop

deployment:
  dockerhub:
    branch: master
    commands:
      - $DOCKER_HUB_TRIGGER